# 数据库知识
## 索引
### B+ Tree原理
#### 数据结构

B树是一颗平衡查找树，并且所有叶子节点位于同一层。

B+树是基于B树和叶子节点顺序访问指针进行实现的，它具有B树的平衡性，并且通过顺序访问指针来提高区间查询的性能

在B+树中，一个节点的key从左到右非递减排序，如果某个指针的左右相邻key分别是key<sub>i</sub>和key<sub>i+1</sub>，且不为空，则该指针指向节点的key大于等于key<sub>i</sub>且小于等于key<sub>i+1</sub> 如图所示：

![](./picture/Bplus.jpg)

#### 操作
进行查找时，首先在根节点进行二分查找，找到一个key所在的指针，然后递归地在指针所指向的节点进行查找。直到查找到叶子节点，然后在叶子节点上进行二分查找，找出key所对应的data

插入删除操作会破坏平衡树的平衡性，因此在插入删除操作之后，需要对树进行一个分裂、合并、旋转等操作来维护平衡性。

### 红黑树
是一种平衡的二叉查找树

红黑树的特性：

- 每个节点为黑色或者是红色
- 根节点是黑色
- 每个叶子节点（NIL）是黑色（叶子节点是指为空的节点）
- 如果一个节点是红色，则其子节点必须是黑色
- 从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑节点

![](./picture/RBTree.jpg)

### B+树与红黑树的比较
文件系统及其数据库系统普遍采用 B+树作为索引结构的原因：

#### 1、更少的查找次数

平衡树查找操作的时间复杂度和树高有关 O(h)=O(log<sub>d</sub>N)其中d为每个节点的出度。

红黑树的出度为2，而B+树的出度一般都非常大，所以红黑树的树高h明显要比B+树大的非常多，查找次数也多

#### 2、利用磁盘预读特性
为了减少磁盘I/O操作，磁盘往往不是严格按需读取，而是每次都会预读。预读过程中，磁盘进行顺序读取，顺序读取不需要进行磁盘寻道，并且只需要很短的磁盘旋转时间，速度会非常快，B+树的特点可以通过顺序访问指针来满足预读需求。








